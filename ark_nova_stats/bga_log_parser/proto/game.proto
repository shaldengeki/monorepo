syntax = "proto3";

enum ActionCard {
    // todo build etc
}

message PlayAnimal {
    int32 card_id = 1;

    // TODO: handle enclosure
    // extra actions, effects from map or animals
}

message AnimalsAction {
    repeated PlayAnimal animals = 1;
}

message BuildingCoordinate {
    int32 x = 1;
    int32 y = 2;
}

enum BuildingType {
    BUILDINGTYPE_UNKNOWN = 0;
    PAVILION = 1;
    KIOSK = 2;
    ENCLOSURE = 3;
    REPTILE_HOUSE = 4;
    AVIARY = 5;
    // TODO: unique buildings
}

message PlayBuilding {
    int32 size = 1;
    BuildingType type = 2;
    repeated BuildingCoordinate coordinates = 3;
    // TODO: extra actions, effects from map
}

message BuildAction {
    repeated PlayBuilding builds = 2;
}

message BreakSponsor {}

message PlaySponsor {
    int32 card_id = 1;
    optional PlayBuilding building = 2;
    // TODO: extra actions, effects from sponsor
}

message PlaySponsors {
    repeated PlaySponsor play_sponsor = 1;
}

message SponsorsAction {
    oneof action {
        BreakSponsor break = 1;
        PlaySponsors play_sponsors = 2;
    }
}

message AssociateReputation {}

enum PartnerZoo {
    PARTNERZOO_UNKNOWN = 0;
    AFRICA = 1;
    AMERICAS = 2;
    ASIA = 3;
    AUSTRALIA = 4;
    EUROPE = 5;
}

enum University {
    UNIVERSITY_UNKNOWN = 0;
    TWO_SCIENCE = 1;
    SCIENCE_TWO_REPUTATION = 2;
    REPUTATION_HAND_SIZE = 3;
}

message AssociatePartnerZoo {
    PartnerZoo partner_zoo = 1;
}

message AssociateUniversity {
    University university = 1;
}

// TODO: change these to separate types and a oneof,
// because some of these require further player choices,
// like snapping, clever, university, buildings, etc
enum ConservationProjectRecurringReward {
    CONSERVATIONPROJECTRECURRINGREWARD_UNKNOWN = 0;
    SNAPPING = 1;
    BUILD_TWO_SIZE = 2;
    FIVE_INCOME = 3;
    TWO_CLEVERS = 4;
    TWO_POUCH = 5;
    ONE_CONSERVATION_POINT = 6;
    BUY_SPONSOR = 7;
}

enum ConservationProjectOneTimeReward {
    CONSERVATIONPROJECTONETIMEREWARD_UNKNOWN = 0;
    ASSOCIATION_WORKER = 1;
    TWELVE_MONEY = 2;
    THREE_X = 3;
    UNIVERSITY = 4;
    AVIARY_REPTILE_HOUSE = 5;
    DETERMINATION = 6;
    TWO_REPUTATION = 7;
    ONE_CONSERVATION_POINT = 8;
    PARTNER_ZOO = 9;
    GEOGRAPHICAL_BONUS = 10; // TODO: this introduces new choices
}

message ExtraWorker {}

message ThreeSizeEnclosure {
    repeated BuildingCoordinate coordinates = 3;
}

message TwoReputation {}

message FiveMoney {}

message TenMoney {}

message ThreeX {}

message DrawThree {
    repeated DrawCard = 1;
}

message TimesTwoMultiplier {
    ActionCard action = 1;
}

message BuySponsorFromHand {
    int32 card_id = 1;
}

message ConservationTrackReward {
    int32 track_position = 1;
    oneof reward {
        ActionCard upgrade_action = 1;
        ExtraWorker extra_worker = 2;
        University university = 3;
        PartnerZoo partner_zoo = 4;
        ThreeSizeEnclosure three_size_enclosure = 5;
        TwoReputation two_reputation = 6;
        FiveMoney five_money = 7;
        TenMoney ten_money = 8;
        ThreeX three_x = 9;
        DrawThree draw_three = 10;
        TimesTwoMultiplier times_two_multiplier = 11;
        BuySponsorFromHand buy_sponsor_from_hand = 12;
    }
}

message AssociateConservationProject {
    int32 card_id = 1;
    int32 strength = 2;

    oneof project_reward {
        ConservationProjectOneTimeReward one_time_reward = 3;
        ConservationProjectRecurringReward recurring_reward = 4;
    }

    repeated ConservationTrackReward track_rewards = 5;
}

message AssociationAction {
    int32 workers = 1;

    oneof action {
        AssociateReputation reputation = 2;
        AssociatePartnerZoo partner_zoo = 3;
        AssociateUniversity university = 4;
        AssociateConservationProject conservation_project = 5;
    }
}

message DrawCardFromDeck {}

message DrawCardFromDisplay {
    int32 display_position = 1;
    int32 card_id = 2;
}

message DrawCard {
    oneof action {
        DrawCardFromDeck deck_draw = 1;
        DrawCardFromDisplay display_draw = 2;
    }
}

message DiscardCard {
    int32 card_id = 3;
}

message CardsAction {
    repeated DrawCard draws = 1;
    repeated DiscardCard discards = 2;
}

message XAction {}

message SellCard {
    int32 card_id = 1;
}

message ExtraAction {
    oneof action {
        SellCard sell_card = 1;
    }
}

message Action {
    int32 break_num = 1;
    int64 player_id = 2;
    int32 strength = 3;

    oneof action {
        XAction x = 4;
        AnimalsAction animals = 5;
        BuildAction build = 6;
        SponsorsAction sponsors = 7;
        AssociationAction associate = 8;
        CardsAction cards = 9;
    }

    repeated ExtraAction extra_actions = 10;
}

message Round {
    repeated Action actions = 1;
    repeated BreakReward
}

message GameAbandon {}

message GameTie {}

message GameEndResult {
    int32 rank = 1;
    int64 player_id = 2;
}

message GameEnd {
    GameEndResult result = 1;
}

message Game {
    int64 table_id = 1;

    oneof result {
        GameAbandon abandon = 2;
        GameTie tie = 3;
        GameEnd end = 4;
    }

    repeated int64 player_ids = 5;
    repeated Action actions = 6;
}
